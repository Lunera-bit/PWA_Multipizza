<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/inicio"></ion-back-button>
    </ion-buttons>
    <ion-title>Productos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="productos-page">


  <!-- acordeón de filtros (orden + tags) -->
  <div class="filters">
    <ion-accordion-group>
      <ion-accordion value="filtros">
        <ion-item slot="header" lines="none" class="accordion-header">
          <ion-label>Filtros y orden</ion-label>
          <ion-note slot="end" *ngIf="selectedTags.size">Tags: {{ selectedTags.size }}</ion-note>
        </ion-item>

        <div slot="content" class="accordion-content">
          <!-- orden (desplegable para las 4 opciones) -->
          <div class="sort-filter">
            <ion-item lines="full">
              <ion-label>Ordenar por</ion-label>
              <ion-select placeholder="Seleccionar" [(ngModel)]="sortBy" (ionChange)="onSortChange($event.detail.value)">
                <ion-select-option value="price_desc">Precio: mayor → menor</ion-select-option>
                <ion-select-option value="price_asc">Precio: menor → mayor</ion-select-option>
                <ion-select-option value="name_asc">Nombre: A → Z</ion-select-option>
                <ion-select-option value="name_desc">Nombre: Z → A</ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <!-- tags: sólo para pizzas (detalle en el acordeón) -->
          <div class="tags-filter" *ngIf="isPizzaCategory">
            <label>Tags :</label>
            <div class="chips">
              <ion-chip *ngFor="let t of availableTags" (click)="toggleTag(t)" [class.active]="selectedTags.has(t)">
                <ion-label>{{ t }}</ion-label>
              </ion-chip>
            </div>

            
          </div>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </div>

  <!-- grid de productos (compact cards) -->
  <div class="grid-wrap">
    <ion-grid>
      <ion-row>
        <ion-col size="6" size-sm="4" size-md="3" *ngFor="let p of filtered; trackBy: trackById">
          <ion-card class="product-card compact" (click)="openProduct(p)">
            <div class="card-media">
              <img [src]="p.imagen ?? p.image ?? 'assets/img/placeholder.png'" (error)="onImgError($event)" />
            </div>
            <ion-card-content class="compact-content">
              <div class="title">{{ p.nombre ?? p.name }}</div>
              <div class="price">S/. {{ (p.precio ?? 0) | number:'1.2-2' }}</div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <div *ngIf="!loading && filtered.length === 0" class="empty">
      <ion-icon name="sad-outline"></ion-icon>
      <p>No se encontraron productos.</p>
    </div>
  </div>
</ion-content>